{
    "contents" : "library(limma)\n\nsilacRI.plot = function(ratios, L_intensities, H_intensities){\n  VAL_idx = 3\n  cols = c(\"blue\", \"red\")\n  linecols = c(\"darkblue\", \"darkred\")\n  for(i in VAL_idx:ncol(ratios)){\n    R = ratios[, c(1:(VAL_idx-1),i)]\n    R[, VAL_idx] = log2(R[,VAL_idx])\n    I = L_intensities[, c(1:(VAL_idx-1),i)]\n    I[,VAL_idx] = (log2(I[,VAL_idx]) + log2(H_intensities[, i]))/2 \n  \n    RI = merge(R, I, by=c(\"uniprot_id\",\"Sequence\"))\n    RI.omitNA = na.omit(RI)\n    #RI.omitNA = RI\n    \n    if(i == VAL_idx){\n      fun=plot\n    }else{\n      fun=points\n    }\n    fun(RI.omitNA[,VAL_idx+1], RI.omitNA[,VAL_idx], pch=20, col=cols[i-VAL_idx+1], xlab=\"Avg(Log2(L)+Log2(H))\", ylab=\"Log2(L/H)\")\n    \n    I.fit = lowess(RI.omitNA[,VAL_idx+1], RI.omitNA[,VAL_idx], f=0.4)\n    lines(I.fit$x, I.fit$y, lwd=3, col=linecols[i-VAL_idx+1])\n  }\n  legend(\"topright\", legend=colnames(ratios)[VAL_idx:ncol(ratios)], fill=cols, cex=.6)\n}\n\nsilacRI.normalize = function(df, method=\"scale\"){\n  VAL_idx = 3\n  df[, VAL_idx:ncol(df)] = as.data.frame(normalizeBetweenArrays(as.matrix(df[, VAL_idx:ncol(df)], method=method)))\n  df\n}\n\n# return z-scores\nsilacRI.IDZscore = function(ratios, H_intensities, L_intensities){\n  VAL_idx = 3\n  z_scores = ratios[,1:(VAL_idx-1)]\n  for(i in VAL_idx:ncol(ratios)){\n    col_idxs = c(1:(VAL_idx-1),i)\n    R = ratios[, col_idxs]\n    R = na.omit(R)\n    R[, VAL_idx] = log2(R[,VAL_idx])\n    \n    IL = L_intensities[, col_idxs]\n    IL = na.omit(IL)\n    IH = H_intensities[, col_idxs]\n    I[,VAL_idx] = (log2(I[,VAL_idx]) + log2(H_intensities[, i]))/2 \n    \n    RI = merge(R, I, by=c(\"uniprot_id\",\"Sequence\"), all=T)\n    RI_omitNA = na.omit(RI)\n    colnames(RI_omitNA)[3:4] = c(\"Ratio\", \"Intensity\") \n    RI_omitNA = sqldf(\"select * from RI_omitNA order by Intensity ASC\")\n    \n    bin_size = 200\n    bins=ceiling(nrow(RI_omitNA)/bin_size) ## 200 is a good bin size\n    break_points = c(1,(seq(1,bins) * bin_size))\n    break_points[length(break_points)] = nrow(RI_omitNA)\n    break_values = RI_omitNA$Intensity[break_points]\n    \n    RI_omitNA = cbind(RI_omitNA, cut(RI_omitNA$Intensity, break_values, include.lowest=T,right=F))\n    colnames(RI_omitNA)[5] = \"bin\" \n    RI_omitNA_bins = sqldf(\"select bin, avg(Ratio) as 'I_mean', stdev(Ratio) as 'I_sd' from RI_omitNA group by bin\")\n    RI_2 = sqldf(\"select RI.uniprot_id, RI.Sequence, RI.Ratio / RIB.I_sd as 'IDZ' from RI_omitNA RI left join RI_omitNA_bins RIB on RI.bin= RIB.bin\")\n    z_scores = merge(z_scores, RI_2, by=c(\"uniprot_id\", \"Sequence\"), all=T) \n  }\n  \n  colnames(z_scores) = colnames(ratios)\n  z_scores\n}\n\nratios = read.delim(\"~/Projects/HPCKrogan/Data/HIV-proteomics/Jurkat-Expression-PTM/Vif-Ub/processed_ratio_intensity/042313-tlj-59-62-matrix-ratios-ubi_unique_filtered.txt\")\nplot(log2(ratios$Vif_H_GFP_L), log2(ratios$GFP_H_Vif_L), pch=20, col=\"gray\", xlim=c(-4,4), ylim=c(-4,4), xlab=\"Log2(Vif_H / GFP_L)\", ylab=\"Log2(GFP_H / Vif_L)\")\nabline(h=0,lwd=2, col=\"darkgrey\")\nabline(v=0,lwd=2, col=\"darkgrey\")\nL_intensities = read.delim(\"~/Projects/HPCKrogan/Data/HIV-proteomics/Jurkat-Expression-PTM/Vif-Ub/processed_ratio_intensity/042313-tlj-59-62-matrix-L_intensities-ubi_unique_filtered.txt\")\nH_intensities = read.delim(\"~/Projects/HPCKrogan/Data/HIV-proteomics/Jurkat-Expression-PTM/Vif-Ub/processed_ratio_intensity/042313-tlj-59-62-matrix-H_intensities-ubi_unique_filtered.txt\")\n\n\npdf(\"~/Projects/HPCKrogan/Data/HIV-proteomics/Plots/Ub-scans/Jurkat_VIF_RI_plot.pdf\", width=7, height=5)\nsilacRI.plot(ratios, L_intensities, H_intensities)\ndev.off()\n\nratios = silacRI.normalize(ratios)\nL_intensities = silacRI.normalize(L_intensities)\nH_intensities = silacRI.normalize(H_intensities)\nz_scores = silacRI.IDZscore(ratios, L_intensities, H_intensities)\nwrite.table(z_scores, file=\"../../Data/HIV-proteomics/Jurkat-Expression-PTM/Vif-Ub/processed_ratio_intensity/042313-tlj-59-62-matrix-z_scores.txt\", eol=\"\\n\", sep=\"\\t\", quote=F, row.names=F, col.names=T)\n\n\npdf(\"~/Projects/HPCKrogan/Data/HIV-proteomics/Plots/Ub-scans/Jurkat_VIF_RI_normalized_plot.pdf\", width=7, height=5)\nsilacRI.plot(ratios, L_intensities, H_intensities)\ndev.off()\n\nratios = read.delim(\"~/Projects/HPCKrogan/Data/HIV-proteomics/Jurkat-Expression-PTM/Vpr-Ub/processed_ratio_intensity/042313-tlj-57-60-matrix-ratios-ubi_unique_filtered.txt\")\nL_intensities = read.delim(\"~/Projects/HPCKrogan/Data/HIV-proteomics/Jurkat-Expression-PTM/Vpr-Ub/processed_ratio_intensity/042313-tlj-57-60-matrix-L_intensities-ubi_unique_filtered.txt\")\nH_intensities = read.delim(\"~/Projects/HPCKrogan/Data/HIV-proteomics/Jurkat-Expression-PTM/Vpr-Ub/processed_ratio_intensity/042313-tlj-57-60-matrix-H_intensities-ubi_unique_filtered.txt\")\n\npdf(\"~/Projects/HPCKrogan/Data/HIV-proteomics/Plots/Ub-scans/Jurkat_VPR_RI_plot.pdf\", width=7, height=5)\nsilacRI.plot(ratios, L_intensities, H_intensities)\ndev.off()\n\nratios = silacRI.normalize(ratios)\nL_intensities = silacRI.normalize(L_intensities)\nH_intensities = silacRI.normalize(H_intensities)\n\npdf(\"~/Projects/HPCKrogan/Data/HIV-proteomics/Plots/Ub-scans/Jurkat_VPR_RI_normalized_plot.pdf\", width=7, height=5)\nsilacRI.plot(ratios, L_intensities, H_intensities)\ndev.off()\n\nratios = read.delim(\"~/Projects/HPCKrogan/Data/HIV-proteomics/Jurkat-Expression-PTM/Vpu-Ub/processed_ratio_intensity/051313-tlj-52-55-matrix-ratios-ubi_unique_filtered.txt\")\nL_intensities = read.delim(\"~/Projects/HPCKrogan/Data/HIV-proteomics/Jurkat-Expression-PTM/Vpu-Ub/processed_ratio_intensity/051313-tlj-52-55-matrix-L_intensities-ubi_unique_filtered.txt\")\nH_intensities = read.delim(\"~/Projects/HPCKrogan/Data/HIV-proteomics/Jurkat-Expression-PTM/Vpu-Ub/processed_ratio_intensity/051313-tlj-52-55-matrix-H_intensities-ubi_unique_filtered.txt\")\n\npdf(\"~/Projects/HPCKrogan/Data/HIV-proteomics/Plots/Ub-scans/Jurkat_VPU_RI_plot.pdf\", width=7, height=5)\nsilacRI.plot(ratios, L_intensities, H_intensities)\ndev.off()\n\nratios = silacRI.normalize(ratios)\nL_intensities = silacRI.normalize(L_intensities)\nH_intensities = silacRI.normalize(H_intensities)\n\npdf(\"~/Projects/HPCKrogan/Data/HIV-proteomics/Plots/Ub-scans/Jurkat_VPU_RI_plot_normalized.pdf\", width=7, height=5)\nsilacRI.plot(ratios, L_intensities, H_intensities)\ndev.off()\n",
    "created" : 1371856788716.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4221210570",
    "id" : "742A303E",
    "lastKnownWriteTime" : 1372188239,
    "path" : "~/Projects/HPCKrogan/Scripts/Rscripts/PTM/PTMRIplots.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}